<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Lista aktywności - APSI</title>
    <meta name="description" content="Revolutionary task managment system.">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{{ url_for('static',filename='css/style.min.css') }}">
    <meta name="theme-color" content="#fff">
</head>
<body>
<div class="page {{u.role}}-{{current_view}}-page">
    {% include 'common/navbar.html' %}

    <div class="content-wrapper">
      <div class="container">
        <h1>Czynności
          {% if u.role == 'pracownik' %}
            <a class="btn btn-primary" title="New activity" href="/activities/add?go_back=activities"><i class="fa-solid fa-plus"></i>Nowa czynność</a>
          {% endif %}
        </h1>

        <div class="task-board">
          <div class="task-board">
            <div class="row">
               <div class="col-4">
                 <div class="col-wrapper todo">
                   <h4 class="col-title">Do akceptacji</h4>
                   <div class="task-boxes" id="to-review-boxes">
                     {% for activity in activities %}
                      {% if (activity.supervisor_approved == None and u.role == 'kierownik') or (activity.client_approved == None and u.role == 'klient') %}
                         <div class="task-box">
                           <div class="btn-group options">
                             <button type="button" data-bs-toggle="dropdown" aria-expanded="false">
                               <i class="fa-solid fa-ellipsis-vertical"></i>
                             </button>
                             <ul class="dropdown-menu">
                               {% if activity.supervisor_approved == False or (activity.supervisor_approved == None and activity.client_approved == None) or activity.client_approved == False %}
                                 {% if activity.done_by.id == u.id %}
                                   <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#modal-{{activity.id}}"><i class="fa-solid fa-eye"></i> Edytuj aktywność</a></li>
                                   <li><hr class="dropdown-divider"></li>
                                 {% endif %}
                               {% endif %}
                               {% if u.role == 'kierownik' %}
                                   {% if activity.supervisor_approved == None %}
                                     <li><a class="dropdown-item dropdown-status decline" href="/projects/{{activity.associated_task.associated_project.id}}/{{activity.associated_task.id}}/{{activity.id}}/accept_supervisor/0?go_back=activities">Odrzuć</a></li>
                                     <li><a class="dropdown-item dropdown-status accept" href="/projects/{{activity.associated_task.associated_project.id}}/{{activity.associated_task.id}}/{{activity.id}}/accept_supervisor/1?go_back=activities">Zaakceptuj</a></li>
                                   {% else %}
                                       {% if activity.supervisor_approved == True %}
                                         <li><a class="dropdown-item dropdown-status decline" href="/projects/{{activity.associated_task.associated_project.id}}/{{activity.associated_task.id}}/{{activity.id}}/accept_supervisor/0?go_back=activities">Odrzuć</a></li>
                                         <li><a class="dropdown-item dropdown-status accept" href="/projects/{{activity.associated_task.associated_project.id}}/{{activity.associated_task.id}}/{{activity.id}}/accept_supervisor/2?go_back=activities">Cofnij akceptację</a></li>
                                       {% elif activity.supervisor_approved == False %}
                                         <li><a class="dropdown-item dropdown-status decline" href="/projects/{{activity.associated_task.associated_project.id}}/{{activity.associated_task.id}}/{{activity.id}}/accept_supervisor/2?go_back=activities">Cofnij odrzucenie</a></li>
                                         <li><a class="dropdown-item dropdown-status accept" href="/projects/{{activity.associated_task.associated_project.id}}/{{activity.associated_task.id}}/{{activity.id}}/accept_supervisor/1?go_back=activities">Zaakceptuj</a></li>
                                       {% endif %}
                                   {% endif %}
                               {% elif u.role == 'klient' %}
                                  {% if activity.client_approved == None %}
                                    <li><a class="dropdown-item dropdown-status decline" href="/projects/{{activity.associated_task.associated_project.id}}/{{activity.associated_task.id}}/{{activity.id}}/accept_client/0?go_back=activities">Odrzuć</a></li>
                                    <li><a class="dropdown-item dropdown-status accept" href="/projects/{{activity.associated_task.associated_project.id}}/{{activity.associated_task.id}}/{{activity.id}}/accept_client/1?go_back=activities">Zaakceptuj</a></li>
                                  {% else %}
                                      {% if activity.client_approved == True %}
                                        <li><a class="dropdown-item dropdown-status decline" href="/projects/{{activity.associated_task.associated_project.id}}/{{activity.associated_task.id}}/{{activity.id}}/accept_client/0?go_back=activities">Odrzuć</a></li>
                                        <li><a class="dropdown-item dropdown-status accept" href="/projects/{{activity.associated_task.associated_project.id}}/{{activity.associated_task.id}}/{{activity.id}}/accept_client/2?go_back=activities">Cofnij akceptację</a></li>
                                      {% elif activity.client_approved == False %}
                                        <li><a class="dropdown-item dropdown-status decline" href="/projects/{{activity.associated_task.associated_project.id}}/{{activity.associated_task.id}}/{{activity.id}}/accept_client/2?go_back=activities">Cofnij odrzucenie</a></li>
                                        <li><a class="dropdown-item dropdown-status accept" href="/projects/{{activity.associated_task.associated_project.id}}/{{activity.associated_task.id}}/{{activity.id}}/accept_client/1?go_back=activities">Zaakceptuj</a></li>
                                      {% endif %}
                                  {% endif %}
                               {% endif %}
                               {% if activity.supervisor_approved == True or activity.client_approved == True %}
                                 {% if activity.done_by.id == u.id %}
                                   <li><a class="dropdown-item delete-task" href="/projects/{{activity.associated_task.associated_project.id}}/{{activity.associated_task.id}}/{{activity.id}}/delete"><i class="fa-solid fa-trash-can"></i> Usuń aktywność</a></li>
                                 {% endif %}
                               {% endif %}
                             </ul>
                           </div>

                           <p class="task-author">{{activity.done_by.name}} {{activity.done_by.surname}}</p>

                           {% if activity.associated_task.associated_project.client != None %}
                             {% if activity.client_approved == None %}
                               <p class="status"><span class="todo">Oczekuje na akceptację (Klient)</span></p>
                             {% elif activity.client_approved == True %}
                               <p class="status"><span class="done">Zaakceptowane (Klient)</span></p>
                             {% else %}
                               <p class="status"><span class="rejected">Odrzucone (Klient)</span></p>
                             {% endif %}
                           {% endif %}

                           {% if activity.supervisor_approved == None %}
                             <p class="status"><span class="todo">Oczekuje na akceptację (Kierownik)</span></p>
                           {% elif activity.supervisor_approved == True %}
                             <p class="status"><span class="done">Zaakceptowane (Kierownik)</span></p>
                           {% else %}
                             <p class="status"><span class="rejected">Odrzucone (Kierownik)</span></p>
                           {% endif %}

                            <p class="task-description">{{activity.description}}</p>
                            <p class="task-details"><i class="fa-solid fa-calendar-day"></i> {{activity.date}} <i class="fa-solid fa-clock"></i> {{activity.time|formatdatetime}}</p>
                         </div>
                       {% endif %}
                     {% endfor %}
                   </div>
                 </div>
               </div>

               <div class="col-4">
                 <div class="col-wrapper rejected">
                   <h4 class="col-title">Odrzucone</h4>
                   <div class="task-boxes" id="rejected-boxes">
                     {% for activity in activities %}
                      {% if activity.supervisor_approved == False or activity.client_approved == False %}
                        <div class="task-box">
                          <div class="btn-group options">
                            <button type="button" data-bs-toggle="dropdown" aria-expanded="false">
                              <i class="fa-solid fa-ellipsis-vertical"></i>
                            </button>
                            <ul class="dropdown-menu">
                              {% if activity.supervisor_approved == False or (activity.supervisor_approved == None and activity.client_approved == None) or activity.client_approved == False %}
                                {% if activity.done_by.id == u.id %}
                                  <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#modal-{{activity.id}}"><i class="fa-solid fa-eye"></i> Edytuj aktywność</a></li>
                                  <li><hr class="dropdown-divider"></li>
                                {% endif %}
                              {% endif %}
                              {% if u.role == 'kierownik' %}
                                  {% if activity.supervisor_approved == None %}
                                    <li><a class="dropdown-item dropdown-status decline" href="/projects/{{activity.associated_task.associated_project.id}}/{{activity.associated_task.id}}/{{activity.id}}/accept_supervisor/0?go_back=activities">Odrzuć</a></li>
                                    <li><a class="dropdown-item dropdown-status accept" href="/projects/{{activity.associated_task.associated_project.id}}/{{activity.associated_task.id}}/{{activity.id}}/accept_supervisor/1?go_back=activities">Zaakceptuj</a></li>
                                  {% else %}
                                      {% if activity.supervisor_approved == True %}
                                        <li><a class="dropdown-item dropdown-status decline" href="/projects/{{activity.associated_task.associated_project.id}}/{{activity.associated_task.id}}/{{activity.id}}/accept_supervisor/0?go_back=activities">Odrzuć</a></li>
                                        <li><a class="dropdown-item dropdown-status accept" href="/projects/{{activity.associated_task.associated_project.id}}/{{activity.associated_task.id}}/{{activity.id}}/accept_supervisor/2?go_back=activities">Cofnij akceptację</a></li>
                                      {% elif activity.supervisor_approved == False %}
                                        <li><a class="dropdown-item dropdown-status decline" href="/projects/{{activity.associated_task.associated_project.id}}/{{activity.associated_task.id}}/{{activity.id}}/accept_supervisor/2?go_back=activities">Cofnij odrzucenie</a></li>
                                        <li><a class="dropdown-item dropdown-status accept" href="/projects/{{activity.associated_task.associated_project.id}}/{{activity.associated_task.id}}/{{activity.id}}/accept_supervisor/1?go_back=activities">Zaakceptuj</a></li>
                                      {% endif %}
                                  {% endif %}
                              {% elif u.role == 'klient' %}
                                 {% if activity.client_approved == None %}
                                   <li><a class="dropdown-item dropdown-status decline" href="/projects/{{activity.associated_task.associated_project.id}}/{{activity.associated_task.id}}/{{activity.id}}/accept_client/0?go_back=activities">Odrzuć</a></li>
                                   <li><a class="dropdown-item dropdown-status accept" href="/projects/{{activity.associated_task.associated_project.id}}/{{activity.associated_task.id}}/{{activity.id}}/accept_client/1?go_back=activities">Zaakceptuj</a></li>
                                 {% else %}
                                     {% if activity.client_approved == True %}
                                       <li><a class="dropdown-item dropdown-status decline" href="/projects/{{activity.associated_task.associated_project.id}}/{{activity.associated_task.id}}/{{activity.id}}/accept_client/0?go_back=activities">Odrzuć</a></li>
                                       <li><a class="dropdown-item dropdown-status accept" href="/projects/{{activity.associated_task.associated_project.id}}/{{activity.associated_task.id}}/{{activity.id}}/accept_client/2?go_back=activities">Cofnij akceptację</a></li>
                                     {% elif activity.client_approved == False %}
                                       <li><a class="dropdown-item dropdown-status decline" href="/projects/{{activity.associated_task.associated_project.id}}/{{activity.associated_task.id}}/{{activity.id}}/accept_client/2?go_back=activities">Cofnij odrzucenie</a></li>
                                       <li><a class="dropdown-item dropdown-status accept" href="/projects/{{activity.associated_task.associated_project.id}}/{{activity.associated_task.id}}/{{activity.id}}/accept_client/1?go_back=activities">Zaakceptuj</a></li>
                                     {% endif %}
                                 {% endif %}
                              {% endif %}
                              {% if activity.supervisor_approved == True or activity.client_approved == True %}
                                {% if activity.done_by.id == u.id %}
                                  <li><a class="dropdown-item delete-task" href="/projects/{{activity.associated_task.associated_project.id}}/{{activity.associated_task.id}}/{{activity.id}}/delete"><i class="fa-solid fa-trash-can"></i> Usuń aktywność</a></li>
                                {% endif %}
                              {% endif %}
                            </ul>
                          </div>

                          <p class="task-author">{{activity.done_by.name}} {{activity.done_by.surname}}</p>

                          {% if activity.associated_task.associated_project.client != None %}
                            {% if activity.client_approved == None %}
                              <p class="status"><span class="todo">Oczekuje na akceptację (Klient)</span></p>
                            {% elif activity.client_approved == True %}
                              <p class="status"><span class="done">Zaakceptowane (Klient)</span></p>
                            {% else %}
                              <p class="status"><span class="rejected">Odrzucone (Klient)</span></p>
                            {% endif %}
                          {% endif %}

                          {% if activity.supervisor_approved == None %}
                            <p class="status"><span class="todo">Oczekuje na akceptację (Kierownik)</span></p>
                          {% elif activity.supervisor_approved == True %}
                            <p class="status"><span class="done">Zaakceptowane (Kierownik)</span></p>
                          {% else %}
                            <p class="status"><span class="rejected">Odrzucone (Kierownik)</span></p>
                          {% endif %}

                           <p class="task-description">{{activity.description}}</p>
                           <p class="task-details"><i class="fa-solid fa-calendar-day"></i> {{activity.date}} <i class="fa-solid fa-clock"></i> {{activity.time|formatdatetime}}</p>
                        </div>
                       {% endif %}
                     {% endfor %}
                   </div>
                 </div>
               </div>

               <div class="col-4">
                 <div class="col-wrapper done">
                   <h4 class="col-title">Zakończone</h4>
                   <div class="task-boxes" id="done-boxes">
                     {% for activity in activities %}
                      {% if activity.supervisor_approved == True and activity.client_approved == True %}
                          <div class="task-box">
                            <p class="task-author">
                              {{activity.done_by.name}} {{activity.done_by.surname}}
                            </p>

                            {% if activity.associated_task.associated_project.client != None %}
                              {% if activity.client_approved == None %}
                                <p class="status"><span class="todo">Oczekuje na akceptację (Klient)</span></p>
                              {% elif activity.client_approved == True %}
                                <p class="status"><span class="done">Zaakceptowane (Klient)</span></p>
                              {% else %}
                                <p class="status"><span class="rejected">Odrzucone (Klient)</span></p>
                              {% endif %}
                            {% endif %}

                            {% if activity.supervisor_approved == None %}
                              <p class="status"><span class="todo">Oczekuje na akceptację (Kierownik)</span></p>
                            {% elif activity.supervisor_approved == True %}
                              <p class="status"><span class="done">Zaakceptowane (Kierownik)</span></p>
                            {% else %}
                              <p class="status"><span class="rejected">Odrzucone (Kierownik)</span></p>
                            {% endif %}

                             <p class="task-description">{{activity.description}}</p>
                             <p class="task-details"><i class="fa-solid fa-calendar-day"></i> {{activity.date}} <i class="fa-solid fa-clock"></i> {{activity.time|formatdatetime}}</p>
                          </div>
                       {% endif %}
                     {% endfor %}
                   </div>
                 </div>
               </div>
             </div>
           </div>
        </div>
    </div>
</div>

{% include 'common/footer.html' %}
</body>
</html>
